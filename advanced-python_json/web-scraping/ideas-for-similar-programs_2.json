[
	{
		"component": "header",
		"variant": 1,
		"value": "Ideas for Similar Programs"
	},
	{
		"component": "text",
		"value": "The benefit of <span style=\"\">tab</span>bed browsing is that you can easily open links in new <span style=\"\">tabs</span> to peruse later. A program that automatically opens several links at once can be a nice shortcut to do the following:"
	},
	{
		"component": "text",
		"value": "Open all the product pages after searching a shopping site such as Amazon"
	},
	{
		"component": "text",
		"value": "Open all the links to reviews for a single product"
	},
	{
		"component": "text",
		"value": "Open the result links to photos after performing a search on a photo site such as Flickr or Imgur"
	},
	{
		"component": "header",
		"variant": 1,
		"value": "Project: Downloading All XKCD Comics"
	},
	{
		"component": "text",
		"value": "Blogs and other regularly updating websites usually have a front page with the most recent post as well as a Previous button on the page that takes you to the previous post. Then that post will also have a Previous button, and so on, creating a trail from the most recent page to the first post on the site. If you wanted a copy of the site’s content to read when you’re not online, you could manually navigate over every page and <span style=\"\">save</span> each one. But this is pretty boring work, so let’s write a program to do it instead."
	},
	{
		"component": "text",
		"value": "XKCD is a popular geek webcomic with a website that fits this structure (see Figure 11-6). The front page at <span><a href=\"http://xkcd.com/\">http://xkcd.com/</a></span> has a Prev button that guides the user back through prior comics. Downloading each comic by hand would take forever, but you can write a script to do this in a couple of minutes."
	},
	{
		"component": "text",
		"value": "Here’s what your program does:"
	},
	{
		"component": "text",
		"value": "Loads the XKCD home page."
	},
	{
		"component": "text",
		"value": "<span style=\"\">Saves</span> the comic image on that page."
	},
	{
		"component": "text",
		"value": "Follows the Previous Comic link."
	},
	{
		"component": "text",
		"value": "Repeats until it reaches the first comic."
	},
	{
		"component": "text",
		"value": "“a webcomic of romance, sarcasm, math, and language”"
	},
	{
		"component": "text",
		"value": "This means your <span style=\"\">code</span> will need to do the following:"
	},
	{
		"component": "text",
		"value": "Download pages with the requests module."
	},
	{
		"component": "text",
		"value": "Find the URL of the comic image for a page using Beautiful Soup."
	},
	{
		"component": "text",
		"value": "Download and <span style=\"\">save</span> the comic image to the hard drive with iter_content()."
	},
	{
		"component": "text",
		"value": "Find the URL of the Previous Comic link, and repeat."
	},
	{
		"component": "text",
		"value": "Open a new <span style=\"\">file</span> <span style=\"\">editor</span> window and <span style=\"\">save</span> it as downloadXkcd.py."
	},
	{
		"component": "header",
		"variant": 1,
		"value": "Step 1: Design the Program"
	},
	{
		"component": "text",
		"value": "If you open the browser’s developer tools and inspect the elements on the page, you’ll find the following:"
	},
	{
		"component": "text",
		"value": "The URL of the comic’s image <span style=\"\">file</span> is given by the href attribute of an <img> element."
	},
	{
		"component": "text",
		"value": "The <img> element is inside a <div id=\"comic\"> element."
	},
	{
		"component": "text",
		"value": "The Prev button has a rel HTML attribute with the value prev."
	},
	{
		"component": "text",
		"value": "The first comic’s Prev button links to the <span><a href=\"http://xkcd.com/#\">http://xkcd.com/#</a></span> URL, indicating that there are no more previous pages."
	},
	{
		"component": "text",
		"value": "Make your <span style=\"\">code</span> look like the following:"
	},
	{
		"component": "text",
		"value": "<h1 id=\"spanstylepython3span\">! <span style=\"\">python3</span></h1>"
	},
	{
		"component": "header",
		"variant": 1,
		"value": "downloadXkcd.py - Downloads every single XKCD comic."
	},
	{
		"component": "text",
		"value": "import requests, os, bs4"
	},
	{
		"component": "text",
		"value": "url = <span><a href=\"'http://xkcd.com'\">'http://xkcd.com'</a></span>            "
	},
	{
		"component": "header",
		"variant": 1,
		"value": "starting url"
	},
	{
		"component": "text",
		"value": "os.makedirs('xkcd', exist_ok=<span style=\"\">True</span>)   # store comics in ./xkcd<br>while not url.endswith('#'):<br>    # TODO: Download the page."
	},
	{
		"component": "text",
		"value": "# TODO: Find the URL of the comic image.<br><br># TODO: Download the image.<br><br># TODO: Save the image to ./xkcd.<br><br># TODO: Get the Prev button's url."
	},
	{
		"component": "text",
		"value": "print('Done.')<br>You’ll have a url <span style=\"\">variable</span> that starts with the value '"
	},
	{
		"component": "text",
		"value": "http://xkcd.com'"
	},
	{
		"component": "text",
		"value": "and repeatedly update it (in a for <span style=\"\">loop</span>) with the URL of the current page’s Prev link. At every step in the <span style=\"\">loop</span>, you’ll download the comic at url. You’ll know to end the <span style=\"\">loop</span> when url ends with '#'."
	},
	{
		"component": "text",
		"value": "You will download the image <span style=\"\">files</span> to a folder in the current working directory named xkcd. The call os.makedirs() ensures that this folder exists, and the exist_ok=<span style=\"\">True</span> <span style=\"\">key</span>word argument prevents the function from throwing an exception if this folder already exists. The rest of the <span style=\"\">code</span> is just comments that outline the rest of your program."
	},
	{
		"component": "header",
		"variant": 1,
		"value": "Step 2: Download the Web Page"
	},
	{
		"component": "text",
		"value": "Let’s implement the <span style=\"\">code</span> for downloading the page. Make your <span style=\"\">code</span> look like the following:"
	},
	{
		"component": "text",
		"value": "<h1 id=\"spanstylepython3span\">! <span style=\"\">python3</span></h1>"
	},
	{
		"component": "header",
		"variant": 1,
		"value": "downloadXkcd.py - Downloads every single XKCD comic."
	},
	{
		"component": "text",
		"value": "import requests, os, bs4"
	},
	{
		"component": "text",
		"value": "url = <span><a href=\"'http://xkcd.com'\">'http://xkcd.com'</a></span>              <br>    # starting url<br>os.makedirs('xkcd', exist_ok=<span style=\"\">True</span>)   # store comics in ./xkcd<br>while not url.endswith('#'):"
	},
	{
		"component": "code",
		"type": "python",
		"title": "",
		"value": "# Download the page.<br>    print('Downloading page %s...' % url)<br>    res = requests.get(url)<br>    res.raise_for_status()<br><br>    soup = bs4.BeautifulSoup(res.text)"
	},
	{
		"component": "text",
		"value": "# TODO: Find the URL of the comic image.<br><br># TODO: Download the image.<br><br># TODO: Save the image to ./xkcd.<br><br># TODO: Get the Prev button's url."
	},
	{
		"component": "text",
		"value": "print('Done.')<br>First, print url so that the user knows which URL the program is about to download; then use the requests module’s request.get() function to download it. As always, you immediately call the Response object’s raise<i>for</i>status() method to throw an exception and end the program if something went wrong with the download. Otherwise, you create a BeautifulSoup object from the text of the downloaded page."
	},
	{
		"component": "header",
		"variant": 1,
		"value": "Step 3: Find and Download the Comic Image"
	},
	{
		"component": "text",
		"value": "Make your <span style=\"\">code</span> look like the following:"
	},
	{
		"component": "text",
		"value": "<h1 id=\"spanstylepython3span\">! <span style=\"\">python3</span></h1>"
	},
	{
		"component": "header",
		"variant": 1,
		"value": "downloadXkcd.py - Downloads every single XKCD comic."
	},
	{
		"component": "text",
		"value": "import requests, os, bs4"
	},
	{
		"component": "text",
		"value": "--snip--"
	},
	{
		"component": "code",
		"type": "python",
		"title": "",
		"value": "# Find the URL of the comic image.<br>    comicElem = soup.select('#comic img')<br>    if comicElem == []:<br>         print('Could not find comic image.')<br>    else:<br>         try:<br>             comicUrl = 'http:' + comicElem[0].get('src')<br>             # Download the image.<br>             print('Downloading image %s...' % (comicUrl))<br>             res = requests.get(comicUrl)<br>             res.raise_for_status()<br>         except requests.exceptions.MissingSchema:<br>             # skip this comic<br>             prevLink = soup.select('a[rel=\"prev\"]')[0]<br>             url = 'http://xkcd.com' + prevLink.get('href')<br>             continue"
	},
	{
		"component": "text",
		"value": "# TODO: Save the image to ./xkcd.<br><br># TODO: Get the Prev button's url."
	},
	{
		"component": "text",
		"value": "print('Done.')<br>From inspecting the XKCD home page with your developer tools, you know that the <img> element for the comic image is inside a <div> element with the id attribute set to comic, so the selector '#comic img' will get you the correct <img> element from the BeautifulSoup object."
	},
	{
		"component": "text",
		"value": "A few XKCD pages have special content that isn’t a simple image <span style=\"\">file</span>. That’s fine; you’ll just skip those. If your selector doesn’t find any elements, then soup.select('#comic img') will return a blank list. When that happens, the program can just print an <span style=\"\">error</span> message and move on without downloading the image."
	},
	{
		"component": "text",
		"value": "Otherwise, the selector will return a list containing one <img> element. You can get the src attribute from this <img> element and pass it to requests.get() to download the comic’s image <span style=\"\">file</span>."
	},
	{
		"component": "header",
		"variant": 1,
		"value": "Step 4: <span style=\"\">Save</span> the Image and Find the Previous Comic"
	},
	{
		"component": "text",
		"value": "Make your <span style=\"\">code</span> look like the following:"
	},
	{
		"component": "text",
		"value": "#! python3<br># downloadXkcd.py - Downloads every single XKCD comic."
	},
	{
		"component": "text",
		"value": "import requests, os, bs4"
	},
	{
		"component": "text",
		"value": "--snip--"
	},
	{
		"component": "code",
		"type": "python",
		"title": "",
		"value": "# Save the image to ./xkcd.<br>        imageFile = open(os.path.join('xkcd', os.path.basename(comicUrl)), 'wb')<br>        for chunk in res.iter_content(100000):<br>            imageFile.write(chunk)<br>        imageFile.close()<br><br>    # Get the Prev button's url.<br>    prevLink = soup.select('a[rel=\"prev\"]')[0]<br>    url = 'http://xkcd.com' + prevLink.get('href')"
	},
	{
		"component": "text",
		"value": "print('Done.')<br>At this point, the image <span style=\"\">file</span> of the comic is stored in the res <span style=\"\">variable</span>. You need to write this image data to a <span style=\"\">file</span> on the hard drive."
	},
	{
		"component": "text",
		"value": "You’ll need a <span style=\"\">file</span>name for the local image <span style=\"\">file</span> to pass to open(). The comicUrl will have a value like <span><a href=\"'http://imgs.xkcd.com/comics/heartbleed_explanation.png'—which \">'http://imgs.xkcd.com/comics/heartbleed<i>explanation.png'—which </a></span> you might have noticed looks a lot like a <span style=\"\">file</span> path. And in fact, you can call os.path.basename() with comicUrl, and it will return just the last part of the URL, 'heartbleed</i>explanation.png'. You can use this as the <span style=\"\">file</span>name when saving the image to your hard drive. You join this name with the name of your xkcd folder using os.path.join() so that your program uses backslashes () on Windows and forward slashes (/) on OS X and Linux. Now that you finally have the <span style=\"\">file</span>name, you can call open() to open a new <span style=\"\">file</span> in 'wb' “write binary” mode."
	},
	{
		"component": "text",
		"value": "Remember from earlier in this chapter that to <span style=\"\">save</span> <span style=\"\">files</span> you’ve downloaded using Requests, you need to <span style=\"\">loop</span> over the return value of the iter_content() method. The <span style=\"\">code</span> in the for <span style=\"\">loop</span> writes out chunks of the image data (at most 100,000 bytes each) to the <span style=\"\">file</span> and then you close the <span style=\"\">file</span>. The image is now <span style=\"\">save</span>d to your hard drive."
	},
	{
		"component": "text",
		"value": "Afterward, the selector 'a[rel=\"prev\"]' identifies the <a> element with the rel attribute set to prev, and you can use this <a> element’s href attribute to get the previous comic’s URL, which gets stored in url. Then the while <span style=\"\">loop</span> begins the entire download process again for this comic."
	},
	{
		"component": "text",
		"value": "The <span style=\"\">output</span> of this program will look like this:"
	},
	{
		"component": "text",
		"value": "Downloading page <span><a href=\"http://xkcd.com…\">http://xkcd.com…</a></span><br>Downloading image <span><a href=\"http://imgs.xkcd.com/comics/phone_alarm.png…\">http://imgs.xkcd.com/comics/phone<i>alarm.png…</a></span><br>Downloading page <span><a href=\"http://xkcd.com/1358/…\">http://xkcd.com/1358/…</a></span><br>Downloading image <span><a href=\"http://imgs.xkcd.com/comics/nro.png…\">http://imgs.xkcd.com/comics/nro.png…</a></span><br>Downloading page <span><a href=\" http://xkcd.com/1357/…\"> http://xkcd.com/1357/…</a></span><br>Downloading image <span><a href=\"http://imgs.xkcd.com/comics/free_speech.png…\">http://imgs.xkcd.com/comics/free</i>speech.png…</a></span><br>Downloading page <span><a href=\" http://xkcd.com/1356/…\"> http://xkcd.com/1356/…</a></span><br>Downloading image <span><a href=\"http://imgs.xkcd.com/comics/orbital_mechanics.png…\">http://imgs.xkcd.com/comics/orbital<i>mechanics.png…</a></span><br>Downloading page <span><a href=\" http://xkcd.com/1355/…\"> http://xkcd.com/1355/…</a></span><br>Downloading image <span><a href=\"http://imgs.xkcd.com/comics/airplane_message.png…\">http://imgs.xkcd.com/comics/airplane</i>message.png…</a></span><br>Downloading page <span><a href=\" http://xkcd.com/1354/…\"> http://xkcd.com/1354/…</a></span><br>Downloading image <span><a href=\"http://imgs.xkcd.com/comics/heartbleed_explanation.png…\">http://imgs.xkcd.com/comics/heartbleed_explanation.png…</a></span><br>--snip--<br>This project is a good example of a program that can automatically follow links in order to scrape large amounts of data from the Web. You can learn about Beautiful Soup’s other features from its documentation at <span><a href=\"http://www.crummy.com/software/BeautifulSoup/bs4/doc/.\">http://www.crummy.com/software/BeautifulSoup/bs4/doc/.</a></span>"
	},
	{
		"component": "header",
		"variant": 1,
		"value": "Ideas for Similar Programs"
	},
	{
		"component": "text",
		"value": "Downloading pages and following links are the basis of many web crawling programs. Similar programs could also do the following:"
	},
	{
		"component": "text",
		"value": "Back up an entire site by following all of its links."
	},
	{
		"component": "text",
		"value": "Copy all the messages off a web forum."
	},
	{
		"component": "text",
		"value": "Duplicate the catalog of items for sale on an online store."
	},
	{
		"component": "text",
		"value": "The requests and BeautifulSoup modules are great as long as you can figure out the URL you need to pass to requests.get(). However, sometimes this isn’t so easy to find. Or perhaps the website you want your program to navigate requires you to log in first. The selenium module will give your programs the power to perform such sophisticated tasks."
	}
]